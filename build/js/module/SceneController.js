define(["require","THREE","module/manager/SceneManager","module/manager/CameraManager","module/manager/TouchSensorManager","module/component/TransformTool","module/util/ModelFrameSet","module/GlobalVar","thirdLib/threejs/OrbitControls"],function(e){"use strict";function l(e){this._domElement=e,this._sceneManager=new n,this._cameraManager=new r(this._domElement.parentElement.clientWidth,window.innerHeight,e),this._touchSensorManager=null,this._init()}var t=e("THREE"),n=e("module/manager/SceneManager"),r=e("module/manager/CameraManager"),i=e("module/manager/TouchSensorManager"),s=e("module/component/TransformTool"),o=e("module/util/ModelFrameSet"),u=e("module/GlobalVar");e("thirdLib/threejs/OrbitControls");var a=null,f=null;return l.prototype._init=function(){a=this,u.sceneController=this,this._initTouchSensorManager(),this._bindEvent()},l.prototype._initTouchSensorManager=function(){this._touchSensorManager=new i,u.touchSensorManager=this._touchSensorManager},l.prototype._bindEvent=function(){this._domElement.addEventListener("mousedown",this.onMouseDown,!1),this._domElement.addEventListener("mousemove",this.onMouseMove,!1),this._domElement.addEventListener("mouseup",this.onMouseUp,!1),this._domElement.addEventListener("mouseout",this.onMouseUp,!1),this._domElement.addEventListener("mousewheel",this.onMouseWheel,!1),this._domElement.addEventListener("DOMMouseScroll",this.onMouseWheel,!1),this._domElement.addEventListener("touchstart",this.onTouchStart,!1),this._domElement.addEventListener("touchmove",this.onTouchMove,!1),this._domElement.addEventListener("touchend",this.onTouchEnd,!1),this._domElement.addEventListener("touchcancel",this.onMouseUp,!1),this._domElement.addEventListener("touchleave",this.onMouseUp,!1)},l.prototype.spawnModel=function(e){o.addModelFrame(e),this._sceneManager.addMesh(e.get().model),this._sceneManager.addStaticMesh(e.get().box),e.update(),o.manageOverlapOtherModel(e)},l.prototype.disposeModel=function(e){this._sceneManager.removeMesh(e.get().model),this._sceneManager.removeStaticMesh(e.get().box),o.removeModelFrame(e)},l.prototype.spawnMesh=function(e){this._sceneManager.addStaticMesh(e)},l.prototype.onMouseDown=function(e){u.touchSensorManager.onOperatingStart(e,"onMouseDown")},l.prototype.onTouchStart=function(e){u.touchSensorManager.onOperatingStart(e,"onTouchStart")},l.prototype.queryModelFrameByVector=function(e,t){var r=this._sceneManager.getVectorHitResultBy(e,t,n.prototype.HIT_RESULT_CHANNEL.MESH);return 0<r.length&&null===o.getModelFrame(r[0].object)&&(r.length=0),r},l.prototype.queryModelFrame=function(e){var t=this._queryMesh(e);return 0<t.length&&null===o.getModelFrame(t[0].object)&&(t.length=0),t},l.prototype.queryModelSupport=function(e){var t=this._queryMesh(e);return 0<t.length&&null===ModelSupportSet.getModelSupport(t[0].object)&&(t.length=0),t},l.prototype._queryMesh=function(e){return this._sceneManager.getHitResultBy(e,n.prototype.HIT_RESULT_CHANNEL.MESH)},l.prototype.onMouseMove=function(e){u.touchSensorManager.onOperatingMove(e,"onMouseMove")},l.prototype.onTouchMove=function(e){u.touchSensorManager.onOperatingMove(e,"onTouchMove")},l.prototype.onMouseUp=function(e){u.touchSensorManager.onOperatingEnd(e,"onMouseUp")},l.prototype.onTouchEnd=function(e){u.touchSensorManager.onOperatingEnd(e,"onTouchEnd")},l.prototype.onMouseWheel=function(e){u.touchSensorManager.onZoomOperating(e)},l.prototype.update=function(){this._touchSensorManager.update()},l.prototype.getCameraManager=function(){return this._cameraManager},l.prototype.getSceneManager=function(){return this._sceneManager},l.prototype.getRenderTarget=function(){return{scene:this.getSceneManager().get(),camera:this.getCameraManager().get(),domElement:this._domElement}},l.prototype.onWindowResize=function(){this._cameraManager.get().aspect=this._domElement.parentElement.clientWidth/window.innerHeight,this._cameraManager.get().updateProjectionMatrix()},l});